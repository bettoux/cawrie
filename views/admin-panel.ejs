<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Amplify</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Quill WYSIWYG Editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .ql-editor { min-height: 120px; }
        .ql-container { font-family: 'Inter', sans-serif; font-size: 14px; }
        .ql-toolbar { background: #f9fafb; border-top-left-radius: 0.5rem; border-top-right-radius: 0.5rem; }
        .custom-color-section { 
            padding: 12px; 
            border-top: 1px solid #e5e7eb; 
            background: white;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <div class="flex justify-between items-center">
                    <h1 class="text-2xl font-bold text-gray-900">Amplify Admin Panel</h1>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-600">Welcome, <strong><%= user.username %></strong></span>
                        <a href="/" target="_blank" class="text-sm text-gray-600 hover:text-gray-900">
                            View Website
                        </a>
                        <% if (user.role === 'admin') { %>
                        <a href="/admin/users" class="text-sm text-purple-600 hover:text-purple-700 font-medium">
                            User Management
                        </a>
                        <% } %>
                        <a href="/admin/logout" class="px-4 py-2 bg-red-600 text-white text-sm rounded-lg hover:bg-red-700 transition-colors">
                            Logout
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Language Tabs -->
            <div class="bg-white rounded-lg shadow mb-6">
                <div class="border-b border-gray-200">
                    <nav class="flex -mb-px">
                        <button onclick="switchLanguage('en')" 
                                class="language-tab active px-6 py-4 text-sm font-medium border-b-2 border-purple-600 text-purple-600">
                            English
                        </button>
                        <button onclick="switchLanguage('fr')" 
                                class="language-tab px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                            Français
                        </button>
                    </nav>
                </div>
            </div>

            <!-- Success Message -->
            <div id="success-message" class="hidden mb-6 rounded-md bg-green-50 p-4">
                <div class="flex">
                    <svg class="h-5 w-5 text-green-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                    </svg>
                    <p class="ml-3 text-sm font-medium text-green-800">Content updated successfully!</p>
                </div>
            </div>

            <!-- Content Form -->
            <form id="content-form" class="space-y-6">
                <!-- English Content -->
                <div id="content-en" class="tab-content active space-y-6">
                    <!-- Navigation -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-xl font-semibold mb-4">Navigation</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">About Us</label>
                                <input type="text" name="en.nav.about" value="<%= content.en.nav.about %>" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Initiatives</label>
                                <input type="text" name="en.nav.initiatives" value="<%= content.en.nav.initiatives %>" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Contact</label>
                                <input type="text" name="en.nav.contact" value="<%= content.en.nav.contact %>" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Donate</label>
                                <input type="text" name="en.nav.donate" value="<%= content.en.nav.donate %>" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            </div>
                        </div>
                    </div>

                    <!-- Hero Section -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-xl font-semibold mb-4">Hero Section</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Title Line 1</label>
                                <input type="text" name="en.hero.title1" value="<%= content.en.hero.title1 %>" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Title Line 2</label>
                                <input type="text" name="en.hero.title2" value="<%= content.en.hero.title2 %>" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Description (Rich Text)</label>
                                <div id="editor-en-hero-description"></div>
                                <input type="hidden" name="en.hero.description" id="en-hero-description">
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Learn More Button</label>
                                    <input type="text" name="en.hero.learnMore" value="<%= content.en.hero.learnMore %>" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Get Involved Button</label>
                                    <input type="text" name="en.hero.getInvolved" value="<%= content.en.hero.getInvolved %>" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- Featured Initiatives Section -->
                    <!-- Featured Initiatives Section -->
                    <!-- Featured Initiatives Section -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-xl font-semibold mb-4">Featured Initiative</h2>
                        <p class="text-sm text-gray-600 mb-4">Showcase one initiative in a prominent section right after the hero.</p>
                        <div class="space-y-4">
                            <div class="flex items-center">
                                <input type="checkbox" 
                                    id="en-featured-enabled" 
                                    name="en.featured.enabled" 
                                    value="true"
                                    <%= content.en.featured && content.en.featured.enabled ? 'checked' : '' %>
                                    class="h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded">
                                <label for="en-featured-enabled" class="ml-2 block text-sm font-medium text-gray-700">
                                    Enable Featured Initiative Section
                                </label>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Select Initiative to Feature</label>
                                <select name="en.featured.initiativeIndex" 
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                    <% content.en.initiatives.cards.forEach((card, index) => { %>
                                    <option value="<%= index %>" <%= content.en.featured && content.en.featured.initiativeIndex === index ? 'selected' : '' %>>
                                        <%= card.title %>
                                    </option>
                                    <% }); %>
                                </select>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Button Text</label>
                                    <input type="text" 
                                        name="en.featured.buttonText" 
                                        value="<%= content.en.featured && content.en.featured.buttonText ? content.en.featured.buttonText : 'Learn More' %>" 
                                        placeholder="Learn More"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Button Link</label>
                                    <input type="text" 
                                        name="en.featured.buttonLink" 
                                        value="<%= content.en.featured && content.en.featured.buttonLink ? content.en.featured.buttonLink : '#initiatives' %>" 
                                        placeholder="#initiatives or https://example.com"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                    <p class="text-xs text-gray-500 mt-1">Use #section for internal links or full URL for external links</p>
                                </div>
                            </div>
                        </div>
                    </div>




                    <!-- About Section -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-xl font-semibold mb-4">About Section</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                                <input type="text" name="en.about.title" value="<%= content.en.about.title %>" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Paragraph 1 (Rich Text)</label>
                                <div id="editor-en-about-paragraph1"></div>
                                <input type="hidden" name="en.about.paragraph1" id="en-about-paragraph1">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Paragraph 2 (Rich Text)</label>
                                <div id="editor-en-about-paragraph2"></div>
                                <input type="hidden" name="en.about.paragraph2" id="en-about-paragraph2">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">About Image</label>
                                <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                                    <div class="text-center">
                                        <img id="preview-en-about-image" src="<%= content.en.about.image || 'https://placehold.co/600x400?text=Upload+Image' %>" 
                                             alt="About section preview" class="mx-auto h-48 w-auto rounded-lg mb-3">
                                        <input type="hidden" name="en.about.image" id="en-about-image" value="<%= content.en.about.image || '' %>">
                                        <input type="file" id="upload-en-about-image" accept="image/*" class="hidden">
                                        <button type="button" onclick="document.getElementById('upload-en-about-image').click()" 
                                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 mr-2">
                                            Upload New Image
                                        </button>
                                        <button type="button" onclick="deleteImage('en-about-image')" 
                                                class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                                            Remove Image
                                        </button>
                                        <p class="text-xs text-gray-500 mt-2">Recommended: 600x400px, Max 5MB (JPG, PNG, GIF, WebP)</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Initiatives Section -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-xl font-semibold mb-4">Initiatives Section</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                                <input type="text" name="en.initiatives.title" value="<%= content.en.initiatives.title %>" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Subtitle</label>
                                <input type="text" name="en.initiatives.subtitle" value="<%= content.en.initiatives.subtitle %>" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            </div>
                            
                            
                            <% content.en.initiatives.cards.forEach((card, index) => { %>
                            <div class="border-t pt-4 mt-4">
                                <h3 class="font-medium text-gray-900 mb-3">Initiative <%= index + 1 %></h3>
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                                        <input type="text" name="en.initiatives.cards[<%= index %>].title" value="<%= card.title %>" 
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Description (Rich Text)</label>
                                        <div id="editor-en-initiatives-cards-<%= index %>"></div>
                                        <input type="hidden" name="en.initiatives.cards[<%= index %>].description" id="en-initiatives-cards-<%= index %>">
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Button Text</label>
                                            <input type="text" 
                                                name="en.initiatives.cards[<%= index %>].buttonText" 
                                                value="<%= card.buttonText || 'Learn More' %>" 
                                                placeholder="Learn More"
                                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Button Link</label>
                                            <input type="text" 
                                                name="en.initiatives.cards[<%= index %>].buttonLink" 
                                                value="<%= card.buttonLink || '#contact' %>" 
                                                placeholder="#contact or https://example.com"
                                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                            <p class="text-xs text-gray-500 mt-1">Use #section for internal links or full URL for external</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% }); %>



                        </div>
                    </div>

                    <!-- Contact Section -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-xl font-semibold mb-4">Contact Section</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                                <input type="text" name="en.contact.title" value="<%= content.en.contact.title %>" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Description (Rich Text)</label>
                                <div id="editor-en-contact-description"></div>
                                <input type="hidden" name="en.contact.description" id="en-contact-description">
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Address (HTML allowed)</label>
                                    <textarea name="en.contact.address" rows="2" 
                                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"><%= content.en.contact.address %></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                    <input type="email" name="en.contact.email" value="<%= content.en.contact.email %>" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                </div>
                            </div>
                            <div class="border-t pt-4">
                                <h3 class="font-medium text-gray-900 mb-3">Form Labels</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Name Label</label>
                                        <input type="text" name="en.contact.form.name" value="<%= content.en.contact.form.name %>" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Email Label</label>
                                        <input type="text" name="en.contact.form.email" value="<%= content.en.contact.form.email %>" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Subject Label</label>
                                        <input type="text" name="en.contact.form.subject" value="<%= content.en.contact.form.subject %>" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Message Label</label>
                                        <input type="text" name="en.contact.form.message" value="<%= content.en.contact.form.message %>" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Submit Button</label>
                                        <input type="text" name="en.contact.form.submit" value="<%= content.en.contact.form.submit %>" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Success Message</label>
                                        <input type="text" name="en.contact.form.success" value="<%= content.en.contact.form.success %>" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Footer -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-xl font-semibold mb-4">Footer</h2>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Copyright</label>
                            <input type="text" name="en.footer.copyright" value="<%= content.en.footer.copyright %>" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                        </div>
                    </div>
                </div>

                <!-- French Content -->
                <div id="content-fr" class="tab-content space-y-6">
                    <!-- Navigation -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-xl font-semibold mb-4">Navigation</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">À Propos</label>
                                <input type="text" name="fr.nav.about" value="<%= content.fr.nav.about %>" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Initiatives</label>
                                <input type="text" name="fr.nav.initiatives" value="<%= content.fr.nav.initiatives %>" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Contact</label>
                                <input type="text" name="fr.nav.contact" value="<%= content.fr.nav.contact %>" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Faire un Don</label>
                                <input type="text" name="fr.nav.donate" value="<%= content.fr.nav.donate %>" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            </div>
                        </div>
                    </div>

                    <!-- Hero Section -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-xl font-semibold mb-4">Section Héro</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Titre Ligne 1</label>
                                <input type="text" name="fr.hero.title1" value="<%= content.fr.hero.title1 %>" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Titre Ligne 2</label>
                                <input type="text" name="fr.hero.title2" value="<%= content.fr.hero.title2 %>" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Description (Texte Enrichi)</label>
                                <div id="editor-fr-hero-description"></div>
                                <input type="hidden" name="fr.hero.description" id="fr-hero-description">
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Bouton En Savoir Plus</label>
                                    <input type="text" name="fr.hero.learnMore" value="<%= content.fr.hero.learnMore %>" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Bouton S'Impliquer</label>
                                    <input type="text" name="fr.hero.getInvolved" value="<%= content.fr.hero.getInvolved %>" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- Featured Initiatives Section (French) -->
                    <!-- Featured Initiatives Section (French) -->
                    <!-- Featured Initiatives Section (French) -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-xl font-semibold mb-4">Initiative en Vedette</h2>
                        <p class="text-sm text-gray-600 mb-4">Mettez en valeur une initiative dans une section proéminente juste après le héro.</p>
                        <div class="space-y-4">
                            <div class="flex items-center">
                                <input type="checkbox" 
                                    id="fr-featured-enabled" 
                                    name="fr.featured.enabled" 
                                    value="true"
                                    <%= content.fr.featured && content.fr.featured.enabled ? 'checked' : '' %>
                                    class="h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded-lg">
                                <label for="fr-featured-enabled" class="ml-2 block text-sm font-medium text-gray-700">
                                    Activer la Section Initiative en Vedette
                                </label>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Sélectionner l'Initiative à Mettre en Vedette</label>
                                <select name="fr.featured.initiativeIndex" 
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                    <% content.fr.initiatives.cards.forEach((card, index) => { %>
                                    <option value="<%= index %>" <%= content.fr.featured && content.fr.featured.initiativeIndex === index ? 'selected' : '' %>>
                                        <%= card.title %>
                                    </option>
                                    <% }); %>
                                </select>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Texte du Bouton</label>
                                    <input type="text" 
                                        name="fr.featured.buttonText" 
                                        value="<%= content.fr.featured && content.fr.featured.buttonText ? content.fr.featured.buttonText : 'En Savoir Plus' %>" 
                                        placeholder="En Savoir Plus"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Lien du Bouton</label>
                                    <input type="text" 
                                        name="fr.featured.buttonLink" 
                                        value="<%= content.fr.featured && content.fr.featured.buttonLink ? content.fr.featured.buttonLink : '#initiatives' %>" 
                                        placeholder="#initiatives ou https://exemple.com"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                    <p class="text-xs text-gray-500 mt-1">Utilisez #section pour les liens internes ou URL complète pour les liens externes</p>
                                </div>
                            </div>
                        </div>
                    </div>




                    <!-- About Section -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-xl font-semibold mb-4">Section À Propos</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Titre</label>
                                <input type="text" name="fr.about.title" value="<%= content.fr.about.title %>" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Paragraphe 1 (Texte Enrichi)</label>
                                <div id="editor-fr-about-paragraph1"></div>
                                <input type="hidden" name="fr.about.paragraph1" id="fr-about-paragraph1">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Paragraphe 2 (Texte Enrichi)</label>
                                <div id="editor-fr-about-paragraph2"></div>
                                <input type="hidden" name="fr.about.paragraph2" id="fr-about-paragraph2">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Image À Propos</label>
                                <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                                    <div class="text-center">
                                        <img id="preview-fr-about-image" src="<%= content.fr.about.image || 'https://placehold.co/600x400?text=Télécharger+Image' %>" 
                                             alt="Aperçu section à propos" class="mx-auto h-48 w-auto rounded-lg mb-3">
                                        <input type="hidden" name="fr.about.image" id="fr-about-image" value="<%= content.fr.about.image || '' %>">
                                        <input type="file" id="upload-fr-about-image" accept="image/*" class="hidden">
                                        <button type="button" onclick="document.getElementById('upload-fr-about-image').click()" 
                                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 mr-2">
                                            Télécharger Nouvelle Image
                                        </button>
                                        <button type="button" onclick="deleteImage('fr-about-image')" 
                                                class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                                            Supprimer l'Image
                                        </button>
                                        <p class="text-xs text-gray-500 mt-2">Recommandé: 600x400px, Max 5MB (JPG, PNG, GIF, WebP)</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Initiatives Section -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-xl font-semibold mb-4">Section Initiatives</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Titre</label>
                                <input type="text" name="fr.initiatives.title" value="<%= content.fr.initiatives.title %>" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Sous-titre</label>
                                <input type="text" name="fr.initiatives.subtitle" value="<%= content.fr.initiatives.subtitle %>" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            </div>
                            

                            <% content.fr.initiatives.cards.forEach((card, index) => { %>
                            <div class="border-t pt-4 mt-4">
                                <h3 class="font-medium text-gray-900 mb-3">Initiative <%= index + 1 %></h3>
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Titre</label>
                                        <input type="text" name="fr.initiatives.cards[<%= index %>].title" value="<%= card.title %>" 
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Description (Texte Enrichi)</label>
                                        <div id="editor-fr-initiatives-cards-<%= index %>"></div>
                                        <input type="hidden" name="fr.initiatives.cards[<%= index %>].description" id="fr-initiatives-cards-<%= index %>">
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Texte du Bouton</label>
                                            <input type="text" 
                                                name="fr.initiatives.cards[<%= index %>].buttonText" 
                                                value="<%= card.buttonText || 'En Savoir Plus' %>" 
                                                placeholder="En Savoir Plus"
                                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Lien du Bouton</label>
                                            <input type="text" 
                                                name="fr.initiatives.cards[<%= index %>].buttonLink" 
                                                value="<%= card.buttonLink || '#contact' %>" 
                                                placeholder="#contact ou https://exemple.com"
                                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                            <p class="text-xs text-gray-500 mt-1">Utilisez #section pour les liens internes ou URL complète pour externes</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% }); %>




                        </div>
                    </div>

                    <!-- Contact Section -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-xl font-semibold mb-4">Section Contact</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Titre</label>
                                <input type="text" name="fr.contact.title" value="<%= content.fr.contact.title %>" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Description (Texte Enrichi)</label>
                                <div id="editor-fr-contact-description"></div>
                                <input type="hidden" name="fr.contact.description" id="fr-contact-description">
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Adresse (HTML autorisé)</label>
                                    <textarea name="fr.contact.address" rows="2" 
                                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"><%= content.fr.contact.address %></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Courriel</label>
                                    <input type="email" name="fr.contact.email" value="<%= content.fr.contact.email %>" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                </div>
                            </div>
                            <div class="border-t pt-4">
                                <h3 class="font-medium text-gray-900 mb-3">Étiquettes du Formulaire</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Étiquette Nom</label>
                                        <input type="text" name="fr.contact.form.name" value="<%= content.fr.contact.form.name %>" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Étiquette Courriel</label>
                                        <input type="text" name="fr.contact.form.email" value="<%= content.fr.contact.form.email %>" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Étiquette Sujet</label>
                                        <input type="text" name="fr.contact.form.subject" value="<%= content.fr.contact.form.subject %>" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Étiquette Message</label>
                                        <input type="text" name="fr.contact.form.message" value="<%= content.fr.contact.form.message %>" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Bouton Envoyer</label>
                                        <input type="text" name="fr.contact.form.submit" value="<%= content.fr.contact.form.submit %>" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Message de Succès</label>
                                        <input type="text" name="fr.contact.form.success" value="<%= content.fr.contact.form.success %>" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Footer -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-xl font-semibold mb-4">Pied de Page</h2>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Droits d'Auteur</label>
                            <input type="text" name="fr.footer.copyright" value="<%= content.fr.footer.copyright %>" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="flex justify-end space-x-4 pb-8">
                    <button type="button" onclick="window.location.reload()" 
                            class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                        Cancel
                    </button>
                    <button type="submit" 
                            class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                        Save Changes
                    </button>
                </div>
            </form>
        </main>
    </div>

    <script>
        const editors = {};

        // Initialize Quill editor with custom color picker
        function initEditor(id, content) {
            const container = document.getElementById(`editor-${id}`);
            if (!container) return;

            const editor = new Quill(container, {
                theme: 'snow',
                modules: {
                    toolbar: {
                        container: [
                            [{ 'header': [1, 2, 3, false] }],
                            ['bold', 'italic', 'underline', 'strike'],
                            [{ 'color': [] }, { 'background': [] }],
                            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                            [{ 'align': [] }],
                            ['link'],
                            ['clean']
                        ],
                        handlers: {
                            'color': function(value) {
                                if (value === 'custom') {
                                    customColorHandler(this.quill, 'color');
                                } else {
                                    this.quill.format('color', value);
                                }
                            },
                            'background': function(value) {
                                if (value === 'custom') {
                                    customColorHandler(this.quill, 'background');
                                } else {
                                    this.quill.format('background', value);
                                }
                            }
                        }
                    }
                }
            });
            
            if (content) {
                // Strip outer <p> tags if they exist to prevent nesting
                let cleanContent = content.trim();
                if (cleanContent.startsWith('<p>') && cleanContent.endsWith('</p>')) {
                    // Check if there's only one <p> wrapper
                    const pCount = (cleanContent.match(/<p>/g) || []).length;
                    if (pCount === 1) {
                        cleanContent = cleanContent.slice(3, -4);
                    }
                }
                editor.root.innerHTML = cleanContent;
            }
            
            editors[id] = editor;

            // Add custom color input below toolbar
            addCustomColorPicker(container.parentElement, id);
            
            return editor;
        }

        // Add custom color picker UI
        function addCustomColorPicker(container, editorId) {
            const customSection = document.createElement('div');
            customSection.className = 'custom-color-section';
            customSection.innerHTML = `
                <div class="flex items-center space-x-2">
                    <label class="text-xs font-medium text-gray-700">Custom Color:</label>
                    <input type="color" id="color-picker-${editorId}" class="h-8 w-16 cursor-pointer border border-gray-300 rounded" />
                    <input type="text" id="hex-input-${editorId}" placeholder="#000000" maxlength="7" 
                           class="w-24 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-purple-500" />
                    <button type="button" onclick="applyCustomColor('${editorId}', 'color')" 
                            class="px-3 py-1 bg-purple-600 text-white text-sm rounded hover:bg-purple-700">
                        Text Color
                    </button>
                    <button type="button" onclick="applyCustomColor('${editorId}', 'background')" 
                            class="px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700">
                        Background
                    </button>
                </div>
            `;
            
            container.insertBefore(customSection, container.querySelector('.ql-container'));

            // Sync color picker with hex input
            const colorPicker = document.getElementById(`color-picker-${editorId}`);
            const hexInput = document.getElementById(`hex-input-${editorId}`);
            
            colorPicker.addEventListener('input', (e) => {
                hexInput.value = e.target.value;
            });
            
            hexInput.addEventListener('input', (e) => {
                const hex = e.target.value;
                if (/^#[0-9A-Fa-f]{6}$/.test(hex)) {
                    colorPicker.value = hex;
                }
            });
        }

        // Apply custom color to selected text
        window.applyCustomColor = function(editorId, type) {
            const hexInput = document.getElementById(`hex-input-${editorId}`);
            const color = hexInput.value;
            
            if (!/^#[0-9A-Fa-f]{6}$/.test(color)) {
                alert('Please enter a valid hex color (e.g., #FF5733)');
                return;
            }
            
            const editor = editors[editorId];
            const range = editor.getSelection();
            
            if (range && range.length > 0) {
                editor.format(type, color);
            } else {
                alert('Please select some text first');
            }
        };

        // Initialize all editors when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // English editors
            initEditor('en-hero-description', `<%= content.en.hero.description.replace(/"/g, '&quot;').replace(/\n/g, ' ') %>`);
            initEditor('en-about-paragraph1', `<%= content.en.about.paragraph1.replace(/"/g, '&quot;').replace(/\n/g, ' ') %>`);
            initEditor('en-about-paragraph2', `<%= content.en.about.paragraph2.replace(/"/g, '&quot;').replace(/\n/g, ' ') %>`);
            initEditor('en-contact-description', `<%= content.en.contact.description.replace(/"/g, '&quot;').replace(/\n/g, ' ') %>`);
            
            <% content.en.initiatives.cards.forEach((card, index) => { %>
            initEditor('en-initiatives-cards-<%= index %>', `<%= card.description.replace(/"/g, '&quot;').replace(/\n/g, ' ') %>`);
            <% }); %>

            // French editors
            initEditor('fr-hero-description', `<%= content.fr.hero.description.replace(/"/g, '&quot;').replace(/\n/g, ' ') %>`);
            initEditor('fr-about-paragraph1', `<%= content.fr.about.paragraph1.replace(/"/g, '&quot;').replace(/\n/g, ' ') %>`);
            initEditor('fr-about-paragraph2', `<%= content.fr.about.paragraph2.replace(/"/g, '&quot;').replace(/\n/g, ' ') %>`);
            initEditor('fr-contact-description', `<%= content.fr.contact.description.replace(/"/g, '&quot;').replace(/\n/g, ' ') %>`);
            
            <% content.fr.initiatives.cards.forEach((card, index) => { %>
            initEditor('fr-initiatives-cards-<%= index %>', `<%= card.description.replace(/"/g, '&quot;').replace(/\n/g, ' ') %>`);
            <% }); %>

            // Setup image upload handlers
            setupImageUpload('en-about-image');
            setupImageUpload('fr-about-image');
        });

        function setupImageUpload(fieldId) {
            const input = document.getElementById('upload-' + fieldId);
            const preview = document.getElementById('preview-' + fieldId);
            const hiddenField = document.getElementById(fieldId);
            
            if (!input) return;
            
            input.addEventListener('change', async function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                // Validate file size
                if (file.size > 5 * 1024 * 1024) {
                    alert('File size must be less than 5MB');
                    return;
                }
                
                // Show loading
                preview.style.opacity = '0.5';
                
                const formData = new FormData();
                formData.append('image', file);
                
                try {
                    const response = await fetch('/api/upload-image', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        // Update preview and hidden field
                        preview.src = result.imageUrl;
                        hiddenField.value = result.imageUrl;
                        preview.style.opacity = '1';
                        
                        // Show success message briefly
                        const successMsg = document.createElement('div');
                        successMsg.className = 'text-green-600 text-sm mt-2';
                        successMsg.textContent = '✓ Image uploaded successfully';
                        preview.parentElement.appendChild(successMsg);
                        setTimeout(() => successMsg.remove(), 3000);
                    } else {
                        alert('Upload failed: ' + result.message);
                        preview.style.opacity = '1';
                    }
                } catch (error) {
                    alert('Error uploading image: ' + error.message);
                    preview.style.opacity = '1';
                }
            });
        }

        async function deleteImage(fieldId) {
            const hiddenField = document.getElementById(fieldId);
            const preview = document.getElementById('preview-' + fieldId);
            const imageUrl = hiddenField.value;
            
            if (!imageUrl || imageUrl.includes('placehold.co')) {
                alert('No image to delete');
                return;
            }
            
            if (!confirm('Are you sure you want to delete this image?')) {
                return;
            }
            
            try {
                const response = await fetch('/api/delete-image', {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ imageUrl: imageUrl })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Reset to placeholder
                    const placeholder = 'https://placehold.co/600x400?text=Upload+Image';
                    preview.src = placeholder;
                    hiddenField.value = placeholder;
                } else {
                    alert('Delete failed: ' + result.message);
                }
            } catch (error) {
                alert('Error deleting image: ' + error.message);
            }
        }

        function switchLanguage(lang) {
            document.querySelectorAll('.language-tab').forEach(tab => {
                tab.classList.remove('active', 'border-purple-600', 'text-purple-600');
                tab.classList.add('border-transparent', 'text-gray-500');
            });
            
            event.target.classList.add('active', 'border-purple-600', 'text-purple-600');
            event.target.classList.remove('border-transparent', 'text-gray-500');
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.getElementById('content-' + lang).classList.add('active');
        }


        document.getElementById('content-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Update hidden fields with editor content
            Object.keys(editors).forEach(id => {
                const hiddenField = document.getElementById(id);
                if (hiddenField) {
                    let html = editors[id].root.innerHTML.trim();
                    
                    if (html === '<p><br></p>') {
                        html = '';
                    }
                    
                    hiddenField.value = html;
                }
            });
            
            const formData = new FormData(e.target);
            const data = { en: {}, fr: {} };
            
            function setNestedValue(obj, path, value) {
                const keys = path.split('.');
                let current = obj;
                
                for (let i = 0; i < keys.length - 1; i++) {
                    let key = keys[i];
                    const arrayMatch = key.match(/^(.+)\[(\d+)\]$/);
                    
                    if (arrayMatch) {
                        const [, arrayName, index] = arrayMatch;
                        if (!current[arrayName]) current[arrayName] = [];
                        if (!current[arrayName][index]) current[arrayName][index] = {};
                        current = current[arrayName][index];
                    } else {
                        if (!current[key]) current[key] = {};
                        current = current[key];
                    }
                }
                
                const lastKey = keys[keys.length - 1];
                current[lastKey] = value;
            }
            
            // Handle checkboxes specially
            // Set featured.enabled to false by default
            data.en.featured = { enabled: false, initiativeIndex: 0 };
            data.fr.featured = { enabled: false, initiativeIndex: 0 };
            
            formData.forEach((value, key) => {
                if (key.includes('featured.enabled')) {
                    // Checkbox is checked if present
                    const lang = key.startsWith('en.') ? 'en' : 'fr';
                    data[lang].featured.enabled = true;
                } else if (key.includes('featured.initiativeIndex')) {
                    const lang = key.startsWith('en.') ? 'en' : 'fr';
                    data[lang].featured.initiativeIndex = parseInt(value, 10);
                } else {
                    setNestedValue(data, key, value);
                }
            });
            
            try {
                const response = await fetch('/api/content', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const successMsg = document.getElementById('success-message');
                    successMsg.classList.remove('hidden');
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    
                    setTimeout(() => {
                        successMsg.classList.add('hidden');
                    }, 5000);
                } else {
                    alert('Failed to save changes: ' + result.message);
                }
            } catch (error) {
                alert('Error saving changes: ' + error.message);
            }
        });

        //replace this
        /*document.getElementById('content-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Update hidden fields with editor content
            Object.keys(editors).forEach(id => {
                const hiddenField = document.getElementById(id);
                if (hiddenField) {
                    let html = editors[id].root.innerHTML.trim();
                    
                    // Clean up: If Quill wrapped in <p>, keep it, but ensure consistency
                    // Remove empty <p><br></p> that Quill sometimes adds
                    if (html === '<p><br></p>') {
                        html = '';
                    }
                    
                    hiddenField.value = html;
                }
            });
            
            const formData = new FormData(e.target);
            const data = { en: {}, fr: {} };
            
            function setNestedValue(obj, path, value) {
                const keys = path.split('.');
                let current = obj;
                
                for (let i = 0; i < keys.length - 1; i++) {
                    let key = keys[i];
                    const arrayMatch = key.match(/^(.+)\[(\d+)\]$/);
                    
                    if (arrayMatch) {
                        const [, arrayName, index] = arrayMatch;
                        if (!current[arrayName]) current[arrayName] = [];
                        if (!current[arrayName][index]) current[arrayName][index] = {};
                        current = current[arrayName][index];
                    } else {
                        if (!current[key]) current[key] = {};
                        current = current[key];
                    }
                }
                
                const lastKey = keys[keys.length - 1];
                current[lastKey] = value;
            }
            
            formData.forEach((value, key) => {
                setNestedValue(data, key, value);
            });
            
            try {
                const response = await fetch('/api/content', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const successMsg = document.getElementById('success-message');
                    successMsg.classList.remove('hidden');
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    
                    setTimeout(() => {
                        successMsg.classList.add('hidden');
                    }, 5000);
                } else {
                    alert('Failed to save changes: ' + result.message);
                }
            } catch (error) {
                alert('Error saving changes: ' + error.message);
            }
        });*/
    </script>
</body>
</html>